<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queue Management Control</title>
    <link rel="stylesheet" href="static/style.css">
    <style>
        /* Unified Control App Specific Styles */
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 256px;
            background-color: var(--primary-color, #007bff);
            color: white;
            padding: 20px 0;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .sidebar-header {
            text-align: center;
            padding: 0 20px 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
        }

        .sidebar-header h1 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 300;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin: 0;
        }

        .sidebar-nav a {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
            border-left: 3px solid transparent;
        }

        .sidebar-nav a:hover,
        .sidebar-nav a.active {
            background-color: rgba(255,255,255,0.1);
            border-left-color: white;
        }

        .sidebar-nav a i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color, #007bff);
        }

        .section-header h2 {
            margin: 0;
            color: var(--primary-color, #007bff);
            font-size: 1.8rem;
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .card-header {
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color, #007bff);
            font-size: 1.1rem;
        }

        /* Button Styles */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color, #007bff);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark, #0056b3);
        }

        .btn-success {
            background-color: var(--success-color, #28a745);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--success-dark, #1e7e34);
        }

        .btn-danger {
            background-color: var(--danger-color, #dc3545);
            color: white;
        }

        .btn-danger:hover {
            background-color: var(--danger-dark, #c82333);
        }

        .btn-warning {
            background-color: var(--warning-color, #ffc107);
            color: #212529;
        }

        .btn-warning:hover {
            background-color: var(--warning-dark, #e0a800);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark, #545b62);
        }

        /* Status Grid */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .status-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color, #007bff);
            margin-bottom: 5px;
        }

        .status-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Queue Controls */
        .queue-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        /* Links Section */
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .link-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .link-card h3 {
            margin-top: 0;
            color: var(--primary-color, #007bff);
        }

        .qr-code {
            margin: 15px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }

        .link-url {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
        }

        /* Config Section */
        .config-iframe {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .sidebar-nav {
                display: flex;
                overflow-x: auto;
            }
            
            .sidebar-nav li {
                flex-shrink: 0;
            }
        }

        .help-text {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>Queue Control</h1>
            </div>
            <ul class="sidebar-nav">
                <li><a href="#home" class="nav-link active" data-section="home">
                    <i>üè†</i>Home
                </a></li>
                <li><a href="#queues" class="nav-link" data-section="queues">
                    <i>üìã</i>Queues
                </a></li>
                <li><a href="#links" class="nav-link" data-section="links">
                    <i>üîó</i>Links
                </a></li>
                <li><a href="#config" class="nav-link" data-section="config">
                    <i>‚öôÔ∏è</i>Config
                </a></li>
            </ul>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Home Section -->
            <div id="home" class="content-section active">
                <div class="section-header">
                    <h2>System Status</h2>
                </div>
                
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-value" id="queue-status">-</div>
                        <div class="status-label">Queue Status</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="guest-count">-</div>
                        <div class="status-label">Guests in Queue</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="ready-pool">-</div>
                        <div class="status-label">Ready Pool</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="ready-pool-limit">-</div>
                        <div class="status-label">Ready Pool Limit</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="guests-in-venue">-</div>
                        <div class="status-label">Guests in Venue</div>
                    </div>
                    <div class="status-item">
                        <div class="status-value" id="venue-capacity">-</div>
                        <div class="status-label">Venue Capacity</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Current Queue</div>
                    <div id="queue-list">Loading...</div>
                </div>
            </div>

            <!-- Queues Section -->
            <div id="queues" class="content-section">
                <div class="section-header">
                    <h2>Queue Management</h2>
                </div>
                
                <div class="card">
                    <div class="card-header">Queue Controls</div>
                    <div class="queue-controls">
                        <button class="btn btn-success" id="open-queue">Open Queue</button>
                        <button class="btn btn-danger" id="close-queue">Close Queue</button>
                        <button class="btn btn-warning" id="reset-queue">Reset Queue</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Demo Mode</div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <label for="mock-count-input">Number of mock guests:</label>
                        <input type="number" id="mock-count-input" min="1" max="100" style="width: 120px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button class="btn btn-primary" id="mock-guests-btn">Insert Mock Guests</button>
                        <button class="btn btn-warning" id="reset-mock-counter-btn">Reset Counter</button>
                    </div>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                        Mock guests get unique names (mock0, mock1, mock2...). Use "Reset Counter" to start over from 0.
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">Premium Access</div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <label>
                            <input type="checkbox" id="premium-access-toggle">
                            <span>Enable Premium Access</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <label for="premium-limit-input">Premium Limit:</label>
                        <input type="number" id="premium-limit-input" min="0" max="100" style="width: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button class="btn btn-primary" id="set-premium-limit-btn">Update Premium Limit</button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="one-shot-price-input">One Shot Price ($):</label>
                        <input type="number" id="one-shot-price-input" min="0" max="1000" style="width: 100px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button class="btn btn-primary" id="set-one-shot-price-btn">Update One Shot Price</button>
                    </div>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                        Premium access must be enabled AND premium limit must be >0 for the upgrade button to appear in the guest app.
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">Venue Management</div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <label>
                            <input type="checkbox" id="venue-mode-toggle">
                            <span>Enable Venue Mode</span>
                        </label>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <label for="venue-capacity-input">Venue Capacity:</label>
                        <input type="number" id="venue-capacity-input" min="0" max="10000" style="width: 120px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button class="btn btn-primary" id="set-venue-capacity-btn">Update Venue Capacity</button>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <button class="btn btn-warning" id="decrement-venue-btn">Remove Guest from Venue</button>
                        <span style="color: #666; font-size: 0.9rem;">Use this when a guest leaves the venue</span>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">Ready Pool Configuration</div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <label for="ready-pool-input">Ready Pool Size:</label>
                        <input type="number" id="ready-pool-input" min="0" max="100" style="width: 80px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <button class="btn btn-primary" id="set-ready-pool">Set</button>
                    </div>
                    <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">
                        Set to 0 to disable ready pool. When enabled, the first N guests in the queue are considered "ready" and can be scanned in any order.
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">Daily Operations</div>
                    <div class="form-group">
                        <button onclick="dailyReset()" class="btn btn-danger">Daily Reset Queue</button>
                        <p class="help-text">Clears all guests from queue while preserving configuration. Use at start of business day.</p>
                    </div>
                </div>
            </div>

            <!-- Links Section -->
            <div id="links" class="content-section">
                <div class="section-header">
                    <h2>Application Links</h2>
                </div>
                
                <div class="card">
                    <div class="card-header">Legacy Admin Panel (Deprecated)</div>
                    <p style="color: #666; margin-bottom: 15px;">
                        The old admin control panel is deprecated. All functionality has been moved to this unified control app. 
                        You can still access it for reference, but it may not work correctly with the current API.
                    </p>
                    <button class="btn btn-secondary" onclick="openLegacyAdmin()">Open Legacy Admin Panel</button>
                </div>
                
                <div class="links-grid">
                    <div class="link-card">
                        <h3>Guest App</h3>
                        <div class="qr-code" id="guest-qr">QR Code will appear here</div>
                        <div class="link-url" id="guest-url">Loading...</div>
                        <button class="btn btn-primary" onclick="openGuestApp()">Open Guest App</button>
                    </div>
                    
                    <div class="link-card">
                        <h3>Attendant App</h3>
                        <div class="qr-code" id="attendant-qr">QR Code will appear here</div>
                        <div class="link-url" id="attendant-url">Loading...</div>
                        <button class="btn btn-primary" onclick="openAttendantApp()">Open Attendant App</button>
                    </div>
                    
                    <div class="link-card">
                        <h3>Clicker App</h3>
                        <div class="qr-code" id="clicker-qr">QR Code will appear here</div>
                        <div class="link-url" id="clicker-url">Loading...</div>
                        <button class="btn btn-primary" onclick="openClickerApp()">Open Clicker App</button>
                    </div>
                </div>
            </div>

            <!-- Config Section -->
            <div id="config" class="content-section">
                <div class="section-header">
                    <h2>Site Configuration</h2>
                </div>
                
                <div class="card">
                    <div class="card-header">Configuration Management</div>
                    <p>Use the interface below to manage site colors, text, and branding:</p>
                    <iframe src="site_config_cms.html" class="config-iframe" title="Site Configuration"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="static/config.js"></script>
    <script src="static/site_config.js"></script>
    <script>
        // Navigation functionality
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links and sections
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // API helper function
        function api(endpoint, options = {}) {
            const url = window.API_BASE + endpoint;
            console.log('API call:', url, options);
            return fetch(url, {
                headers: {
                    'Content-Type': 'application/json',
                },
                ...options
            }).then(response => {
                console.log('API response status:', response.status);
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error(`API error: ${response.status}`);
                }
            });
        }

        // Load initial data
        function loadStatus() {
            console.log('Loading status...');
            api('/status')
                .then(data => {
                    console.log('Status API response:', data);
                    // Fix: Map the correct API response fields to UI elements
                    document.getElementById('queue-status').textContent = data.is_open ? 'Open' : 'Closed';
                    document.getElementById('guest-count').textContent = data.queue ? data.queue.length : 0;
                    document.getElementById('ready-pool').textContent = data.ready_pool ? data.ready_pool.length : 0;
                    document.getElementById('ready-pool-limit').textContent = data.ready_pool_limit || 'Not Set';
                    document.getElementById('guests-in-venue').textContent = data.guests_in_venue || 0;
                    document.getElementById('venue-capacity').textContent = data.venue_capacity || 'Not Set';
                    
                    // Update queue list with proper data structure
                    const queueList = document.getElementById('queue-list');
                    if (data.queue && data.queue.length > 0) {
                        queueList.innerHTML = data.queue.map((guest, index) => 
                            `<div style="padding: 5px 0; border-bottom: 1px solid #eee;">
                                <strong>Position ${index}:</strong> ${guest.email} 
                                <span style="color: #666;">(${guest.guest_location})</span>
                                ${guest.premium ? '<span style="color: #ffc107; margin-left: 10px;">‚≠ê Premium</span>' : ''}
                            </div>`
                        ).join('');
                    } else {
                        queueList.innerHTML = '<em>No guests in queue</em>';
                    }
                })
                .catch(error => {
                    console.error('Error loading status:', error);
                    document.getElementById('queue-list').innerHTML = '<em>Error loading queue status</em>';
                    // Set error states for other elements
                    document.getElementById('queue-status').textContent = 'Error';
                    document.getElementById('guest-count').textContent = 'Error';
                    document.getElementById('ready-pool').textContent = 'Error';
                    document.getElementById('ready-pool-limit').textContent = 'Error';
                    document.getElementById('guests-in-venue').textContent = 'Error';
                    document.getElementById('venue-capacity').textContent = 'Error';
                });
        }

        // Queue control functions
        document.getElementById('open-queue').addEventListener('click', () => {
            console.log('Opening queue...');
            api('/open', { method: 'POST' })
                .then(response => {
                    console.log('Open queue response:', response);
                    loadStatus();
                })
                .catch(error => console.error('Error opening queue:', error));
        });

        document.getElementById('close-queue').addEventListener('click', () => {
            console.log('Closing queue...');
            api('/close', { method: 'POST' })
                .then(response => {
                    console.log('Close queue response:', response);
                    loadStatus();
                })
                .catch(error => console.error('Error closing queue:', error));
        });

        document.getElementById('reset-queue').addEventListener('click', () => {
            if (confirm('Are you sure you want to reset the queue? This will remove all guests.')) {
                console.log('Resetting queue...');
                api('/reset', { method: 'POST' })
                    .then(response => {
                        console.log('Reset queue response:', response);
                        loadStatus();
                    })
                    .catch(error => console.error('Error resetting queue:', error));
            }
        });

        // Ready pool control
        document.getElementById('set-ready-pool').addEventListener('click', () => {
            const limit = document.getElementById('ready-pool-input').value;
            api('/set-ready-pool-limit', {
                method: 'POST',
                body: JSON.stringify({ limit: parseInt(limit) })
            })
                .then(() => loadStatus())
                .catch(error => console.error('Error setting ready pool limit:', error));
        });

        // Load current ready pool limit
        function loadReadyPoolLimit() {
            console.log('Loading ready pool limit...');
            api('/status')
                .then(data => {
                    console.log('Ready pool limit data:', data);
                    if (data.ready_pool_limit) {
                        document.getElementById('ready-pool-input').value = data.ready_pool_limit;
                    }
                })
                .catch(error => console.error('Error loading ready pool limit:', error));
        }

        // Load all queue configuration values
        function loadQueueConfig() {
            console.log('Loading queue config...');
            api('/status')
                .then(data => {
                    console.log('Queue config data:', data);
                    // Load ready pool limit
                    if (data.ready_pool_limit) {
                        document.getElementById('ready-pool-input').value = data.ready_pool_limit;
                    }
                    
                    // Load premium limit
                    if (data.premium_limit !== undefined) {
                        document.getElementById('premium-limit-input').value = data.premium_limit;
                    }
                    
                    // Load premium access toggle
                    if (data.premium_access_enabled !== undefined) {
                        document.getElementById('premium-access-toggle').checked = data.premium_access_enabled;
                    }
                    
                    // Load one shot price
                    if (data.one_shot_price !== undefined) {
                        document.getElementById('one-shot-price-input').value = data.one_shot_price;
                    }
                    
                    // Load venue mode
                    if (data.venue_mode_enabled !== undefined) {
                        document.getElementById('venue-mode-toggle').checked = data.venue_mode_enabled;
                    }
                    
                    // Load venue capacity
                    if (data.venue_capacity !== undefined) {
                        document.getElementById('venue-capacity-input').value = data.venue_capacity;
                    }
                })
                .catch(error => console.error('Error loading queue config:', error));
        }

        // Demo mode functions
        document.getElementById('mock-guests-btn').addEventListener('click', () => {
            const count = document.getElementById('mock-count-input').value;
            if (count > 0) {
                api(`/mock-guests/${count}`, { method: 'POST' })
                    .then(() => {
                        loadStatus();
                        document.getElementById('mock-count-input').value = '';
                    })
                    .catch(error => console.error('Error adding mock guests:', error));
            }
        });

        document.getElementById('reset-mock-counter-btn').addEventListener('click', () => {
            if (confirm('Are you sure you want to reset the mock guest counter? This will remove all mock guests from the queue.')) {
                console.log('Resetting mock guest counter...');
                api('/reset-mock-counter', { method: 'POST' })
                    .then(() => {
                        console.log('Mock guest counter reset successful');
                        loadStatus();
                    })
                    .catch(error => console.error('Error resetting mock guest counter:', error));
            }
        });

        // Premium access functions
        document.getElementById('set-premium-limit-btn').addEventListener('click', () => {
            const limit = document.getElementById('premium-limit-input').value;
            if (limit >= 0) {
                api('/set-premium-limit', {
                    method: 'POST',
                    body: JSON.stringify({ limit: parseInt(limit) })
                })
                    .then(() => loadStatus())
                    .catch(error => console.error('Error setting premium limit:', error));
            }
        });

        document.getElementById('premium-access-toggle').addEventListener('change', () => {
            const enabled = document.getElementById('premium-access-toggle').checked;
            api('/set-premium-access', {
                method: 'POST',
                body: JSON.stringify({ enabled })
            })
                .then(() => loadStatus())
                .catch(error => console.error('Error toggling premium access:', error));
        });

        document.getElementById('set-one-shot-price-btn').addEventListener('click', () => {
            const price = document.getElementById('one-shot-price-input').value;
            if (price >= 0) {
                api('/set-one-shot-price', {
                    method: 'POST',
                    body: JSON.stringify({ price: parseInt(price) })
                })
                    .then(() => loadStatus())
                    .catch(error => console.error('Error setting one shot price:', error));
            }
        });

        // Venue management functions
        document.getElementById('venue-mode-toggle').addEventListener('change', () => {
            const enabled = document.getElementById('venue-mode-toggle').checked;
            api('/set-venue-mode', {
                method: 'POST',
                body: JSON.stringify({ enabled })
            })
                .then(() => loadStatus())
                .catch(error => console.error('Error toggling venue mode:', error));
        });

        document.getElementById('set-venue-capacity-btn').addEventListener('click', () => {
            const capacity = document.getElementById('venue-capacity-input').value;
            if (capacity >= 0) {
                api('/set-venue-capacity', {
                    method: 'POST',
                    body: JSON.stringify({ capacity: parseInt(capacity) })
                })
                    .then(() => loadStatus())
                    .catch(error => console.error('Error setting venue capacity:', error));
            }
        });

        // Decrement venue count
        document.getElementById('decrement-venue-btn').addEventListener('click', () => {
            api('/decrement-venue', { method: 'POST' })
                .then(() => loadStatus())
                .catch(error => console.error('Error decrementing venue:', error));
        });

        // Daily reset function
        function dailyReset() {
            if (confirm('Are you sure you want to perform a daily reset? This will clear all guests from the queue while preserving configuration.')) {
                console.log('Performing daily reset...');
                api('/daily-reset', { method: 'POST' })
                    .then(() => {
                        console.log('Daily reset successful');
                        loadStatus();
                    })
                    .catch(error => {
                        console.error('Error performing daily reset:', error);
                        alert('Failed to perform daily reset. Please try again.');
                    });
            }
        }

        // Update URLs and QR codes
        function updateLinks() {
            const baseUrl = window.location.origin + window.location.pathname.replace('unified_control_app.html', '');
            
            // Guest app
            document.getElementById('guest-url').textContent = baseUrl + 'guest_web_app.html';
            
            // Attendant app
            document.getElementById('attendant-url').textContent = baseUrl + 'attendant_web_app.html';
            
            // Clicker app
            document.getElementById('clicker-url').textContent = baseUrl + 'clicker_web_app.html';
            
            // TODO: Generate QR codes for each URL
            // For now, we'll show placeholder text
        }

        // App opening functions
        function openGuestApp() {
            window.open('guest_web_app.html', '_blank');
        }

        function openAttendantApp() {
            window.open('attendant_web_app.html', '_blank');
        }

        function openClickerApp() {
            window.open('clicker_web_app.html', '_blank');
        }

        // Legacy admin panel function
        function openLegacyAdmin() {
            window.open('admin_control_panel.html', '_blank');
        }

        // Initialize the app
        function init() {
            console.log('Initializing unified control app...');
            console.log('API_BASE:', window.API_BASE);
            
            loadStatus();
            loadReadyPoolLimit();
            loadQueueConfig(); // Load all queue config values
            updateLinks();
            
            // Refresh status every 30 seconds
            setInterval(loadStatus, 30000);
            
            console.log('Unified control app initialized');
        }

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
